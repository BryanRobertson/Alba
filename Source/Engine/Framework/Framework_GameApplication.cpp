#include "Framework_Precompile.hpp"
#include "Framework_GameApplication.hpp"
#include "Core_Memory.hpp"
#include "Core_Pair.hpp"
#include "Core_Window.hpp"
#include "Core_WindowEventHandler.hpp"

#ifdef CreateWindow
	#undef CreateWindow
#endif

namespace Alba
{
	namespace Framework
	{
		//-----------------------------------------------------------------------------------------
		//-----------------------------------------------------------------------------------------
		/*static*/ Core::UniquePtr<GameApplication> GameApplication::Create()
		{
			return Core::UniquePtr<GameApplication>
			(
				ALBA_NEW(Core::AllocationType::Framework, "GameApplication") GameApplication()
			);
		}

		//-----------------------------------------------------------------------------------------
		//-----------------------------------------------------------------------------------------
		GameApplication::GameApplication()
			: myQuit(false)
		{

		}

		//-----------------------------------------------------------------------------------------
		//-----------------------------------------------------------------------------------------
		GameApplication::~GameApplication()
		{
			if (myWindow)
			{
				Shutdown();
			}
		}

		//-----------------------------------------------------------------------------------------
		//-----------------------------------------------------------------------------------------
		uint32 GameApplication::Init(ApplicationInitParams anInitParams)
		{
			myInitParams = std::move(anInitParams);
			CreateWindow(myInitParams.myWindowInitParams);

			return 0;
		}

		//-----------------------------------------------------------------------------------------
		//-----------------------------------------------------------------------------------------
		uint32 GameApplication::Run()
		{
			//-------------------------------------------------------------------------------------
			// Update
			//-------------------------------------------------------------------------------------
			myQuit = false;
			while (!myQuit)
			{
				Update();
			}

			//-------------------------------------------------------------------------------------
			// Shutdown
			//-------------------------------------------------------------------------------------
			Shutdown();

			return 0;
		}

		//-----------------------------------------------------------------------------------------
		//-----------------------------------------------------------------------------------------
		void GameApplication::Update()
		{
			BeginFrame();

			//-----------------------------------------------------------------------------------------
			// Update Window
			//-----------------------------------------------------------------------------------------
			myWindow->Update();

			//-----------------------------------------------------------------------------------------
			// Update Modules
			//-----------------------------------------------------------------------------------------


			//-----------------------------------------------------------------------------------------
			// Render
			//-----------------------------------------------------------------------------------------
			EndFrame();
		}

		//-----------------------------------------------------------------------------------------
		//-----------------------------------------------------------------------------------------
		void GameApplication::BeginFrame()
		{

		}

		//-----------------------------------------------------------------------------------------
		//-----------------------------------------------------------------------------------------
		void GameApplication::EndFrame()
		{

		}

		//-----------------------------------------------------------------------------------------
		//-----------------------------------------------------------------------------------------
		uint32 GameApplication::Shutdown()
		{
			// Destroy window
			myWindow.reset();

			return 0;
		}

		//-----------------------------------------------------------------------------------------
		//-----------------------------------------------------------------------------------------
		void GameApplication::Quit()
		{
			myQuit = true;
		}
	}
}